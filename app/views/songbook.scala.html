@(songs: List[Song])

@admin("") {

    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap-multiselect.css")">
    <script src="@routes.Assets.at("javascripts/jquery-2.1.3.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/bootstrap-multiselect.js")" type="text/javascript"></script>

    <div class="panel-group" id="collapse-accordion">
        <div class="panel panel-default" style="overflow:visible;">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#collapse-accordion" href="#collapse-accordion-one">
                        Songbook creator
                    </a>
                </h4>
            </div>
            <form class="btn-group" id="songbook-form">
                <div class="btn-group">
                    <select id="song-selector" multiple="multiple">
                        @songs.map { song =>
                            @song.songLyrics.zipWithIndex.map{ case (songlyrics, i) =>
                                @if(i==0){
                                    <option id="@song.id" value="@songlyrics.id">@song.songName</option>
                                }
                                @if(i>0){
                                    @defining(i + 1) { idx =>
                                        <option id="@song.id" value="@songlyrics.id">@song.songName @idx</option>
                                    }
                                }
                            }
                        }
                    </select>
                    <select id="title-font" class="btn btn-group btn-default">
                        <option label="Title font">Title font</option>
                        <option value="1">Arial</option>
                        <option value="2">Droid</option>
                        <option value="3">Courier New</option>
                    </select>
                    <select id="lyrics-font" class="btn btn-group btn-default">
                        <option label="Lyrics font">Lyrics font</option>
                        <option value="1">Courier New</option>
                        <option value="2">Droid Mono</option>
                        <option value="3">Arial</option>
                    </select>
                    <button type="reset" id="reset-button" class="btn btn-default"><i class="fa fa-repeat fa-fw"></i>Reset</button>
                    <button type="button" id="submit-button" class="btn btn-default"><i class="fa fa-book fa-fw"></i>Generate</button>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">

    $ ( document ).ready ( function ( ) {
    // copy song table div to dynamic content div
    $('#dynamiccontent').html($('#collapse-accordion').html());
    // delete initial table div
    $('#collapse-accordion' ).remove();

    $('#song-selector').multiselect({
    enableCaseInsensitiveFiltering: true,
    enableFiltering: true,
    includeSelectAllOption: true,
    inheritClass: true,
    disableIfEmpty: true,
    numberDisplayed: 4,
    enableClickableOptGroups: false,
    nonSelectedText: 'Select songs',
    maxHeight: 400
    });

    //reset button
    $('#songbook-form').on('reset', function() {
    $('#song-selector option:selected').each(function() {
        $(this).prop('selected', false);
    })
        $('#reset').multiselect('refresh');
    });

    //generate button
    $('#submit-button').on('click', function() {
        var songIds= [];
        $('#song-selector option:selected').each(function() {
            var songObject = new Object();
            var songValue = new Object();
            songValue.id = $(this).attr('id');
            songValue.lyricsID = $(this).val();
            songValue.key = "C";
            songObject.song = songValue;
            songIds.push(songObject);
        });
        if (songIds==0){
            window.alert("Select songs first");
        }
        else {
            var songBookData = new Object();
            songBookData.songs = songIds;
            var songFont = new Object();
            var titleFont = $('#title-font option:selected').text();
            if (titleFont == "Title font"){
                //default
                titleFont = "Arial";
            }
            songFont.titleFont = titleFont;

            var lyricsFont = $('#lyrics-font option:selected').text();
            if (lyricsFont == "Lyrics font"){
                //default
                lyricsFont = "Courier New";
            }
            songFont.lyricsFont = lyricsFont;

            songBookData.fonts = songFont;

            console.log(songBookData);
            console.log(JSON.stringify(songBookData));

            $.ajax("@routes.Application.generateSongbook()", {
                type: 'POST',
                data: JSON.stringify(songBookData),
                success: function (data) {
                    var link = "@routes.Application.downloadAndDeleteFile()"
                    link = link.concat("?hash=" + data);
                    window.location=link;
                },
                contentType : 'application/json'
            });
        }
    });

    });

    </script>

}