@(songs: List[Song])

@admin("") {

    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap-multiselect.css")">
    <script src="@routes.Assets.at("javascripts/jquery-2.1.3.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/bootstrap-multiselect.js")" type="text/javascript"></script>

    <div class="panel-group" id="example-collapse-accordion">
        <div class="panel panel-default" style="overflow:visible;">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#example-collapse-accordion" href="#example-collapse-accordion-one">
                        Songbook creator
                    </a>
                </h4>
            </div>
            <form class="btn-group" id="example-reset-form">
                <div class="btn-group">
                    <select id="example-reset" multiple="multiple">
                        @songs.map { song =>
                            @song.songLyrics.zipWithIndex.map{ case (songlyrics, i) =>
                                @if(i==0){
                                    <option id="@song.id" value="@songlyrics.id">@song.songName</option>
                                }
                                @if(i>0){
                                    @defining(i + 1) { idx =>
                                        <option id="@song.id" value="@songlyrics.id">@song.songName @idx</option>
                                    }
                                }
                            }
                        }
                    </select>
                    <button type="reset" id="example-reset-button" class="btn btn-default"><i class="fa fa-repeat fa-fw"></i>Reset</button>
                    <button type="button" id="example-submit-button" class="btn btn-default"><i class="fa fa-book fa-fw"></i>Generate</button>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">

    $ ( document ).ready ( function ( ) {
    // copy song table div to dynamic content div
    $('#dynamiccontent').html($('#example-collapse-accordion').html());
    // delete initial table div
    $('#example-collapse-accordion' ).remove();

    $('#example-reset').multiselect({
    enableCaseInsensitiveFiltering: true,
    enableFiltering: true,
    includeSelectAllOption: true,
    inheritClass: true,
    disableIfEmpty: true,
    numberDisplayed: 4,
    enableClickableOptGroups: false,
    nonSelectedText: 'Select songs'
    });

    //reset button
    $('#example-reset-form').on('reset', function() {
    $('#example-reset option:selected').each(function() {
        $(this).prop('selected', false);
    })
        $('#example-reset').multiselect('refresh');
        //console.log(selected);
    });

    //generate button
    $('#example-submit-button').on('click', function() {
        var songLyricsIds = $('#example-reset').val();
        var songIds= [];
        $('#example-reset option:selected').each(function() {
            var songObject = new Object();
            songObject.id = $(this).attr('id');
            songObject.lyricsID = $(this).val();
            songIds.push(songObject);
        })
        var songsJson = JSON.stringify(songIds);
        console.log(songsJson);
        $.ajax("@routes.Application.generateSongbook()", {
            type: 'POST',
            data: songsJson,
            success: function (data) {
                var link = "@routes.Application.downloadAndDeleteFile()"
                link = link.concat("?hash=" + data);
                window.location=link;
            },
            contentType : 'application/json'
        });
        /*
        $.post("@routes.Application.generateSongbook()",
            songsJson,
            function(data, status){
            //window.location = "@routes.Application.downloadAndDeleteFile()";
            });
            */
    });

    });

    </script>

}