@(id: Long, songForm: Form[Song])

@admin("Song Editor"){
    <div id="songEditor">
        <h2>Edit or create song</h2>
        @helper.form(action = routes.Application.newsong()) {
            @helper.inputText(songForm("songName"), args = '_label -> "Song name: ")
            @helper.inputText(songForm("songOriginalTitle"), args = '_label -> "Original title: ")
            @helper.inputText(songForm("songAuthor"), args = '_label -> "Author: ")
            @helper.inputText(songForm("songLink"), args = '_label -> "Link: ")
            @helper.textarea(field = songForm("songLyrics[0].songLyrics"), args = '_label -> "Lyrics: ", 'rows -> 20, 'cols -> 40, 'class -> "monoSpaceTextArea")
            @helper.textarea(field = songForm("songLyrics[1].songLyrics"), args = 'style -> "display:none;", 'rows -> 20, 'cols -> 40, 'class -> "monoSpaceTextArea")
            @helper.textarea(field = songForm("songLyrics[2].songLyrics"), args = 'style -> "display:none;", 'rows -> 20, 'cols -> 40, 'class -> "monoSpaceTextArea")
            @helper.textarea(field = songForm("songLyrics[3].songLyrics"), args = 'style -> "display:none;", 'rows -> 20, 'cols -> 40, 'class -> "monoSpaceTextArea")
            <input type="submit" value="Save">
            @helper.inputText(songForm("id"), args = 'style -> "display:none;")
        }
        <button type="button" id="addAdditionalLyricsButton">Add additional lyrics</button>
    </div>

    <script src="@routes.Assets.at("javascripts/jquery-2.1.3.min.js")" type="text/javascript"></script>
    <script type="text/javascript" src="@routes.Application.javascriptRoutes()"></script>

    <script type="text/javascript">

    $ ( document ).ready ( function ( ) {
        $('#dynamiccontent').html($('#songEditor' ).html());
        $('#songEditor' ).remove();

        var songLyricsCount = 0;
        var id = @id;

        $('#id').attr("value", id);
        $('label[for="id"]').hide();

        function CreateSongEditor(id){
            $('label[for="songLyrics_1_songLyrics"]').hide();
            $('label[for="songLyrics_2_songLyrics"]').hide();
            $('label[for="songLyrics_3_songLyrics"]').hide();

            var songLyricsIDs = [];
            if (id>0){
                jsRoutes.controllers.Application.getsongjson(id).ajax({
                    datatype: 'json',
                    success: function(data) {
                        $('#songName').attr("value", data.songName);
                        $('#songOriginalTitle').attr("value", data.songOriginalTitle);
                        $('#songAuthor').attr("value", data.songAuthor);
                        $('#songLink').attr("value", data.songLink);
                        songLyricsIDs = data.songLyricsIDs;

                        $.each(songLyricsIDs, function(i,s){
                            songLyricsCount = songLyricsCount + 1;
                            jsRoutes.controllers.Application.getsonglyricsjson(s).ajax({
                            success : function ( data ) {
                                var songLyricsTag = '#songLyrics_' + i + '_songLyrics';
                                $ (songLyricsTag).val (data.songLyrics);
                                $ (songLyricsTag).attr ("style", "display:block;");
                            },
                            error : function ( ) {
                                console.log ( "Error: ajax failure" )
                                }
                            })
                    });

                    },
                    error: function() {
                        console.log("Error: ajax failure");
                    }
            })
            }
        }

        $( "#addAdditionalLyricsButton" ).click(function() {
            $('#songLyrics_'+songLyricsCount+'_songLyrics').attr("style", "display:block;");
            songLyricsCount = songLyricsCount + 1;
        });

    CreateSongEditor(id);

    });
    </script>
}

